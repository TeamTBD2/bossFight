<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <title>WebXR AR with Geolocation</title>
  <style>
    body {
      margin: 0;
      overflow: hidden;
    }

    canvas {
      display: block;
    }

    #overlay {
      position: absolute;
      top: 20px;
      left: 20px;
      z-index: 10;
      background-color: rgba(0, 0, 0, 0.5);
      padding: 10px;
      border-radius: 8px;
    }

    button {
      padding: 10px;
      background-color: #2980b9;
      color: white;
      border: none;
      border-radius: 4px;
      cursor: pointer;
    }

    button:hover {
      background-color: #1d6c8c;
    }
  </style>
</head>

<body>
  <div id="overlay">
    <button id="startAR">Start AR</button>
  </div>
  <script src="https://cdn.jsdelivr.net/npm/three@0.150.1/build/three.min.js"></script>
  <script>
    // Initialize the scene, camera, and renderer
    const scene = new THREE.Scene();
    const camera = new THREE.PerspectiveCamera();
    const renderer = new THREE.WebGLRenderer({ antialias: true, alpha: true });
    renderer.setSize(window.innerWidth, window.innerHeight);
    renderer.xr.enabled = true;
    document.body.appendChild(renderer.domElement);

    // Create a red sphere
    const geometry = new THREE.SphereGeometry(1, 32, 32);
    const material = new THREE.MeshStandardMaterial({ color: 0xff0000 });
    const sphere = new THREE.Mesh(geometry, material);
    scene.add(sphere);

    // Lighting
    const light = new THREE.HemisphereLight(0xffffff, 0x444444);
    scene.add(light);

    // Function to convert latitude and longitude to 3D coordinates
    function latLonTo3D(lat, lon, radius = 10) {
      const phi = (90 - lat) * (Math.PI / 180);
      const theta = (lon + 180) * (Math.PI / 180);
      const x = radius * Math.sin(phi) * Math.cos(theta);
      const y = radius * Math.cos(phi);
      const z = radius * Math.sin(phi) * Math.sin(theta);
      return new THREE.Vector3(x, y, z);
    }

    // Function to start the AR session
    function startAR() {
      if (navigator.geolocation) {
        navigator.geolocation.getCurrentPosition((position) => {
          const userLat = position.coords.latitude;
          const userLon = position.coords.longitude;

          // Convert user's location to 3D coordinates
          const spherePosition = latLonTo3D(userLat, userLon);
          sphere.position.set(spherePosition.x, spherePosition.y, spherePosition.z);

          // Start the AR session
          navigator.xr.requestSession('immersive-ar', {
            optionalFeatures: ['dom-overlay'],
            domOverlay: { root: document.getElementById('overlay') }
          }).then((session) => {
            session.addEventListener('end', () => {
              document.getElementById('startAR').textContent = 'Start AR';
            });
            renderer.xr.setReferenceSpaceType('local');
            renderer.xr.setSession(session);
            document.getElementById('startAR').textContent = 'Stop AR';
          });
        }, (error) => {
          console.error('Error obtaining geolocation', error);
        });
      } else {
        console.error('Geolocation is not supported by this browser.');
      }
    }

    // Event listener for the AR button
    document.getElementById('startAR').addEventListener('click', () => {
      if (renderer.xr.getSession() === null) {
        startAR();
      } else {
        renderer.xr.getSession().end();
      }
    });

    // Animation loop
    function animate() {
      renderer.setAnimationLoop(() => {
        renderer.render(scene, camera);
      });
    }
    animate();
  </script>
</body>

</html>