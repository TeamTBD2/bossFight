<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <title>WebXR AR with DOM Overlay</title>
  <style>
    body {
      margin: 0;
      overflow: hidden;
    }

    canvas {
      display: block;
    }

    #overlay {
      position: absolute;
      top: 20px;
      left: 20px;
      z-index: 10;
      background-color: rgba(0, 0, 0, 0.5);
      padding: 10px;
      border-radius: 8px;
    }

    #moveLeft {
      padding: 10px;
      background-color: #2980b9;
      color: white;
      border: none;
      border-radius: 4px;
      cursor: pointer;
    }

    #moveRight {
      padding: 10px;
      background-color: #2980b9;
      color: white;
      border: none;
      border-radius: 4px;
      cursor: pointer;
    }

    #moveDown {
      padding: 10px;
      background-color: #2980b9;
      color: white;
      border: none;
      border-radius: 4px;
      cursor: pointer;
    }

    #moveUp {
      padding: 10px;
      background-color: #2980b9;
      color: white;
      border: none;
      border-radius: 4px;
      cursor: pointer;
    }

    #moveButton:hover {
      background-color: #1d6c8c;
    }
  </style>
</head>

<body>
  <div id="overlay">
    <button id="moveLeft">Move Left</button>
  </div>
  <div id="overlay">
    <button id="moveRight">Move Right</button>
  </div>
  <div id="overlay">
    <button id="moveDown">Move Down</button>
  </div>
  <div id="overlay">
    <button id="moveUp">Move Up</button>
  </div>
  <script src="https://cdn.jsdelivr.net/npm/three@0.150.1/build/three.min.js"></script>
  <script>
    // Initialize the scene, camera, and renderer
    const scene = new THREE.Scene();
    const camera = new THREE.PerspectiveCamera();
    const renderer = new THREE.WebGLRenderer({ antialias: true, alpha: true });
    renderer.setSize(window.innerWidth, window.innerHeight);
    renderer.xr.enabled = true;
    document.body.appendChild(renderer.domElement);

    // Create the AR button
    const arButton = document.createElement('button');
    arButton.style.position = 'absolute';
    arButton.style.top = '20px';
    arButton.style.left = 'calc(50% - 50px)';
    arButton.style.zIndex = '10';
    arButton.style.backgroundColor = '#2980b9';
    arButton.style.color = 'white';
    arButton.style.border = 'none';
    arButton.style.padding = '10px';
    arButton.style.borderRadius = '4px';
    arButton.textContent = 'Start AR';
    document.body.appendChild(arButton);

    // Function to convert latitude and longitude to 3D coordinates
    function latLonTo3D(lat, lon, radius = 10) {
      const phi = (90 - lat) * (Math.PI / 180); // Convert latitude to radians
      const theta = (lon + 180) * (Math.PI / 180); // Convert longitude to radians
      const x = radius * Math.sin(phi) * Math.cos(theta);
      const y = radius * Math.cos(phi);
      const z = radius * Math.sin(phi) * Math.sin(theta);
      return new THREE.Vector3(x, y, z);
    }

    // Create a red sphere
    const geometry = new THREE.SphereGeometry(1, 32, 32);
    const material = new THREE.MeshStandardMaterial({ color: 0xff0000 });
    const sphere = new THREE.Mesh(geometry, material);
    scene.add(sphere);

    // Lighting
    const light = new THREE.HemisphereLight(0xffffff, 0x444444);
    scene.add(light);

    // Function to start the AR session
    function startAR() {
      const sessionInit = {
        optionalFeatures: ['dom-overlay'],
        domOverlay: { root: document.getElementById('overlay') }
      };
      navigator.xr.requestSession('immersive-ar', sessionInit).then(onSessionStarted);
    }

    // Function called when the AR session starts
    function onSessionStarted(session) {
      session.addEventListener('end', onSessionEnded);
      renderer.xr.setReferenceSpaceType('local');
      renderer.xr.setSession(session);
      arButton.textContent = 'Stop AR';
    }

    // Function called when the AR session ends
    function onSessionEnded() {
      arButton.textContent = 'Start AR';
    }

    // Event listener for the AR button
    arButton.addEventListener('click', () => {
      if (renderer.xr.getSession() === null) {
        startAR();
      } else {
        renderer.xr.getSession().end();
      }
    });

    // Event listener for the move button
    document.getElementById('moveLeft').addEventListener('click', () => {
      // Adjust the sphere's position
      sphere.position.x += 1;
      sphere.position.y += 1;
      sphere.position.z += 1;
    });
    document.getElementById('moveRight').addEventListener('click', () => {
      // Adjust the sphere's position
      sphere.position.x += 1;
      sphere.position.y += 1;
      sphere.position.z += 1;
    });
    document.getElementById('moveUp').addEventListener('click', () => {
      // Adjust the sphere's position
      sphere.position.x += 1;
      sphere.position.y += 1;
      sphere.position.z += 1;
    });
    document.getElementById('moveDown').addEventListener('click', () => {
      // Adjust the sphere's position
      sphere.position.x += 1;
      sphere.position.y += 1;
      sphere.position.z += 1;
    });

    // Animation loop
    function animate() {
      renderer.setAnimationLoop(() => {
        renderer.render(scene, camera);
      });
    }
    animate();

    // // Use Geolocation API to get user location
    // if ('geolocation' in navigator) {
    //   navigator.geolocation.getCurrentPosition(
    //     position => {
    //       const userLat = position.coords.latitude;
    //       const userLon = position.coords.longitude;
    //       placeSphereAtLocation(userLat, userLon);
    //     },
    //     error => {
    //       overlay.textContent = "Error getting location.";
    //       console.error(error);
    //     },
    //     { enableHighAccuracy: true }
    //   );
    // } else {
    //   overlay.textContent = "Geolocation not supported.";
    // }
  </script>
</body>

</html>